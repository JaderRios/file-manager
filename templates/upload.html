<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Subir archivos - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #e6f0e9;
      }

      /* Sidebar */
     .sidebar {
        background-color: #13613D;
  min-width: 220px;
  max-width: 220px;
  height: 100vh;
  color: #fff;
  position: fixed;
  top: 0;
  left: 0;
  padding-top: 0;
  display: flex;
  flex-direction: column;
  align-items: stretch;
}

.sidebar-header {
  background-color: #13613D;
  border-bottom: 1px solid rgba(255,255,255,0.2);
}

.sidebar a.sidebar-link {
  color: #fff;
  display: flex;
  background-color: #13613D;
  align-items: center;
  padding: 15px 20px;
  text-decoration: none;
  font-weight: 500;
  font-size: 1rem;
  transition: background 0.3s, padding-left 0.3s;
}

.sidebar a.sidebar-link:hover {
background-color: #13613D;
  padding-left: 25px;
}

.sidebar a i {
  font-size: 1.2rem;
}

      /* Header */
      .dashboard-header {
        position: fixed;
        top: 0;
        left: 220px;
        right: 0;
        height: 60px;
        background-color: #fff;
        border-bottom: 1px solid #dee2e6;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 30px;
        z-index: 1000;
      }

      .main-content {
        margin-left: 220px; /* espacio del sidebar */
        padding: 30px;
        padding-top:100px ;
        display: flex;
        flex-direction: column;
        align-items: center; /* centra horizontalmente */
      }

      /* Card de subida centrado y ancho máximo */
      .card-upload {
        width: 100%;
        max-width: 700px; /* ajusta el ancho máximo */
        padding: 20px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      /* Drop zone */
      .drop-zone {
        padding: 25px;
        border: 2px dashed #ccc;
        border-radius: 8px;
        text-align: center;
        background-color: #fafafa;
        cursor: pointer;
      }
      .drop-zone.dragover {
        background-color: #e9f7ef;
        border-color: #0b6730;
      }

      /* Archivos subidos centrados */
      .archivos {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center; /* centra horizontalmente */
        margin-bottom: 15px;
      }
      .archivo-cuadro {
        width: 150px;
        border-radius: 8px;
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
        font-weight: bold;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-color: #fff;
      }
      .archivo-cuadro i {
        font-size: 3rem;
        margin-bottom: 5px;
      }
      .archivo-cuadro .nombre-archivo {
        font-size: 0.75rem;
        word-break: break-word;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }
      .archivo-cuadro .archivo-info {
        font-size: 0.7rem;
        color: #555;
      }
      .archivo-pdf {
        background-color: #f8d7da;
        color: #d9534f;
        border-color: #d9534f;
      }
      .archivo-word {
        background-color: #d0e3ff;
        color: #0d6efd;
        border-color: #0d6efd;
      }
      .archivo-excel {
        background-color: #d4edda;
        color: #198754;
        border-color: #198754;
      }
      .archivo-otro {
        background-color: #e2e3e5;
        color: #495057;
        border-color: #ced4da;
      }

      /* Progress bar */
      .progress {
        height: 6px;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
  <div class="sidebar-header text-center py-4">
    <img src="/images/logo_blanco.png" alt="Logo" class="logo mb-2" style="width:50px; height:auto;"/>
    <h4 class="m-0">Dashboard</h4>
  </div>
  <a href="#" class="sidebar-link"><i class="bi bi-folder me-2"></i> Archivos</a>
  <a href="/logout" class="sidebar-link"><i class="bi bi-box-arrow-right me-2"></i> Cerrar sesión</a>
</div>


    <!-- Header -->
    <div class="dashboard-header">
      <div>Conectado como: <strong>{{ usuario.nombre }}</strong></div>
    </div>

    <!-- Main content -->
    <div class="main-content">
      {% include "alert.html" with context %}

      <div class="mb-4 card-upload">
        <h3 class="mb-3">Subir archivos</h3>

        <div id="previews" class="archivos"></div>

        <form id="uploadForm" action="/upload" enctype="multipart/form-data" method="post">
          <input type="hidden" name="usuario_id" value="{{ usuario.id }}" />
          <div class="mb-3 drop-zone" id="dropZone">
            Arrastra tus archivos aquí o haz clic para seleccionar
            <input class="form-control" type="file" name="file" multiple required style="display: none" />
          </div>

          <textarea
            class="form-control mt-3"
            name="comentarios"
            placeholder="Agregar comentarios (opcional)"
            rows="2"
          ></textarea>

          <button class="btn" style="background-color: #0b6730; color: #fff" type="submit">Subir</button>

          <div class="progress mt-2" style="display: none">
            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
          </div>
        </form>
      </div>

      <h4>Archivos subidos:</h4>
      <div class="archivos">
        {% for archivo in archivos %} {% set ext = archivo.nombre.lower().split('.')[-1] %}
        <a
          href="/{{ archivo.ruta }}"
          target="_blank"
          class="archivo-cuadro {% if ext == 'pdf' %}archivo-pdf {% elif ext in ['doc','docx'] %}archivo-word {% elif ext in ['xls','xlsx'] %}archivo-excel {% else %}archivo-otro{% endif %}"
        >
          {% if ext in ['png','jpg','jpeg','gif'] %}
          <img
            src="/{{ archivo.ruta }}"
            alt="{{ archivo.nombre }}"
            style="max-width: 100%; max-height: 70px; margin-bottom: 5px"
          />
          {% elif ext == 'pdf' %}
          <i class="bi bi-file-earmark-pdf"></i>
          {% elif ext in ["doc","docx"] %}
          <i class="bi bi-file-earmark-word"></i>
          {% elif ext in ["xls","xlsx"] %}
          <i class="bi bi-file-earmark-spreadsheet"></i>
          {% else %}
          <i class="bi bi-file-earmark"></i>
          {% endif %}

          <span class="nombre-archivo">{{ archivo.nombre }}</span>

          {% if archivo.comentarios %}
          <div style="font-size: 0.7rem; color: #333; margin-top: 4px">{{ archivo.comentarios }}</div>
          {% endif %}
        </a>
        {% endfor %}
      </div>
    </div>

    <script>
      const dropZone = document.getElementById('dropZone');
      const fileInput = dropZone.querySelector('input[type=file]');
      const previewsContainer = document.getElementById('previews');

      dropZone.addEventListener('click', () => fileInput.click());
      dropZone.addEventListener('dragover', e => {
        e.preventDefault();
        dropZone.classList.add('dragover');
      });
      dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
      dropZone.addEventListener('drop', e => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        fileInput.files = e.dataTransfer.files;
        mostrarPreviews(fileInput.files);
      });

      fileInput.addEventListener('change', () => mostrarPreviews(fileInput.files));

      function mostrarPreviews(files) {
        previewsContainer.innerHTML = '';
        dropZone.style.display = files.length > 0 ? 'none' : 'block';

        Array.from(files).forEach(file => {
          const ext = file.name.split('.').pop().toLowerCase();
          const cuadro = document.createElement('div');
          cuadro.className = 'archivo-cuadro';

          if (ext === 'pdf') cuadro.classList.add('archivo-pdf');
          else if (['doc', 'docx'].includes(ext)) cuadro.classList.add('archivo-word');
          else if (['xls', 'xlsx'].includes(ext)) cuadro.classList.add('archivo-excel');
          else cuadro.classList.add('archivo-otro');

          if (['png', 'jpg', 'jpeg', 'gif'].includes(ext)) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            img.style.maxWidth = '100%';
            img.style.maxHeight = '70px';
            img.style.marginBottom = '5px';
            cuadro.appendChild(img);
          } else {
            const icon = document.createElement('i');
            if (ext === 'pdf') icon.className = 'bi bi-file-earmark-pdf';
            else if (['doc', 'docx'].includes(ext)) icon.className = 'bi bi-file-earmark-word';
            else if (['xls', 'xlsx'].includes(ext)) icon.className = 'bi bi-file-earmark-spreadsheet';
            else icon.className = 'bi bi-file-earmark';
            cuadro.appendChild(icon);
          }

          const nombre = document.createElement('span');
          nombre.className = 'nombre-archivo';
          nombre.textContent = file.name;
          cuadro.appendChild(nombre);

          const info = document.createElement('span');
          info.className = 'archivo-info';
          info.textContent = `${(file.size / 1024).toFixed(1)} KB • ${file.type || 'Desconocido'}`;
          cuadro.appendChild(info);

          previewsContainer.appendChild(cuadro);
        });
      }

      const alerts = document.querySelectorAll('.alert');
      alerts.forEach(alert => {
        setTimeout(() => {
          alert.classList.remove('show');
          alert.classList.add('hide');
        }, 3000);
      });

      const form = document.getElementById('uploadForm');
      const progress = form.querySelector('.progress');
      const progressBar = progress.querySelector('.progress-bar');

      form.addEventListener('submit', () => {
        progress.style.display = 'block';
        progressBar.style.width = '0%';
        let width = 0;
        const interval = setInterval(() => {
          if (width >= 100) clearInterval(interval);
          width += 10;
          progressBar.style.width = width + '%';
        }, 50);
      });
    </script>
  </body>
</html>
